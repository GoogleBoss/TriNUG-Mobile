<!DOCTYPE html>
<html>
<head>
    <title>TRINUG</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="Content/jquery.mobile-1.1.0.min.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="cordova.js"></script>
    <script src="Scripts/jquery-1.7.1.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).bind('mobileinit', function () {
            $.mobile.page.prototype.options.backBtnTheme = "e";
            $.mobile.page.prototype.options.headerTheme = "b";
            $.mobile.page.prototype.options.footerTheme = "d";
        })
    </script>
    <script src="Scripts/jquery.mobile-1.1.0.min.js" type="text/javascript"></script>
    <script src="Scripts/jquery.dateFormat-1.0.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            loadEventData();
        });
    </script>
</head>
<body>
    <div data-role="page" id="main">
        <div data-role="content">
            <p style="text-align: center;">
                <img src="Content/images/trinug_headerlogo.png" />
                <h1>Welcome!</h1>
                <p>
                    TRINUG is user group that brings together .NET developers and technology enthusiasts from around the Triangle of North Carolina.
                </p>
            </p>
        </div>
        <!-- /content -->
        <div data-role="footer" style="text-align: center;" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#" data-icon="home" class="ui-btn-active ui-state-persist" data-transition="fade">Home</a></li>
                    <li><a href="#events" data-icon="grid" data-transition="fade">Events</a></li>
                    <li><a href="#about" data-icon="info" data-transition="fade">About</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- / main page -->

    <div data-role="page" data-title="Events" id="events">
        <div data-role="header" data-position="fixed">
            <h1>Events</h1>
        </div>
        <!-- /header -->
        <div data-role="content">
            <ul data-role="listview" id="list" data-filter="true"> 
                    
            </ul>
        </div>
        <!-- /content -->
        <div data-role="footer" style="text-align: center;" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#main" data-icon="home"  data-transition="fade">Home</a></li>
                    <li><a href="#" data-icon="grid" class="ui-btn-active ui-state-persist" data-transition="fade">Events</a></li>
                    <li><a href="#about" data-icon="info" data-transition="fade">About</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- /events page -->
    
    <div data-role="page" id="eventDetails" data-position="fixed" data-add-back-btn="true">
        <div data-role="header">
            <h1>Event Details</h1>
        </div>
        <!-- /header -->
        <div data-role="content">
            <div id="details">
                <h2 id="detailsTitle" class="details"></h2>
                <p id="detailsDate" class="details"></p>
                <div id="detailsLocation" class="details"></div>
                <p id="detailsDescription" class="details"></p>
            </div>
        </div>
        <!-- /content -->
    </div>
    <!-- /event details page -->  

    <div data-role="page" data-title="About" id="about" data-add-back-btn="false">
        <div data-role="header" data-position="fixed">
            <h1>About</h1>
        </div>
        <!-- /header -->
        <div data-role="content">
            <p>
                <strong>What is TRINUG?</strong><br/>
                A user group that brings together .Net developers and technology enthusiasts from around the Triangle of North Carolina. Membership ranges from brand new developers of .Net, to seasoned practitioners. Membership is <strong>always free</strong> and all are welcome.
            </p>
            <p>
                <strong>What kind of Meetings and gatherings do you have?:</strong><br/>
                - A Main meeting where locally & nationally recognized speakers are selected to talk about a new technology or to go in depth on various topics. (2nd Wed)<br/>
                - SIGs (Special Interest Groups) discussions and deep dives that each meet once a month. (1st, 3rd, and 4th Wed)<br/>
                - free, day-long events titled CodeCampRDU.<br/>
                - ad hoc meetings like Nerd Dinners, Pizza/Movie Night, Hack Night, and FireStarters
            </p>
            <strong>PhoneGap API Samples:</strong>
            <p id="connType">
            </p>
            <input type="button" id="vibrateButton" value="Vibrate Notification" onclick="navigator.notification.vibrate(2000);" />
        </div>
        <!-- /content -->
        <div data-role="footer" style="text-align: center;" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#main" data-icon="home"  data-transition="fade">Home</a></li>
                    <li><a href="#events" data-icon="grid" data-transition="fade">Events</a></li>
                    <li><a href="#" data-icon="info" class="ui-btn-active ui-state-persist" data-transition="fade">About</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- /about page --> 
    <script type="text/javascript">
        function loadEventData() {
            var apiKey = "2e6fa4e481d2ee585c356558d21";
            $.getJSON('https://api.meetup.com/2/events?key=' + apiKey + '&sign=true&group_urlname=TriNUG&page=20&callback=?', function (data) {
                var list = $('#events').find('#list');
                list.html('');
                $.each(data, function () {
                    $.each(this, function (k, v) {
                        if (v.time > 0) {
                            var eventDate = new Date(v.time);
                            var eventTitle = '<h1>' + $.format.date(eventDate, "MMM dd, yyyy") + '</h1><p>' + v.name + '</p>';
                            $('<a>')
                                .data('event', v)
                                .bind('click', function () { showDetails($(this).data('event')); })
                                .html(eventTitle)
                                .appendTo($('<li>').appendTo(list));
                        }
                    });
                });
                list.listview("destroy").listview();
            });
        }
        
        function showDetails(event) {
            var eventDate = new Date(event.time);
            $('#detailsTitle.details').text(event.name);
            $('#detailsDate.details').html('<b>' + $.format.date(eventDate, "MMM dd, yyyy") + '</b>');
            $('#detailsDescription.details').html(event.description);
            formatLocation(event.venue);
            $.mobile.changePage($('#eventDetails'), {
                 transition: 'slide'
            });
        }

        function formatLocation(venue) {
            var location = $('#detailsLocation.details');
            location.html('');
            $('<span>')
                .html('<b>' + venue.name + '</b><br/>')
                .appendTo(location);
            if(venue.address_1) {
                $('<span>')
                .html(venue.address_1 + '<br/>')
                .appendTo(location);
            }
            if (venue.address_2) {
                $('<span>')
                .html(venue.address_2 + '<br/>')
                .appendTo(location);
            }
            if (venue.address_3) {
                $('<span>')
                .html(venue.address_3 + '<br/>')
                .appendTo(location);
            }
            if (venue.city) {
                $('<span>')
                .text(venue.city + ', ' + venue.state + '  ' + venue.zip)
                .appendTo(location);
            }
        }
    </script>
    <script type="text/javascript" charset="utf-8">
        // Wait for Cordova to load
        //
        document.addEventListener("deviceready", onDeviceReady, false);

        // Cordova is loaded and it is now safe to make calls Cordova methods
        //
        function onDeviceReady() {
            checkConnection();
            loadEventData();
        }

        function checkConnection() {
            var networkState = navigator.network.connection.type;

            var states = {};
            states[Connection.UNKNOWN] = 'Unknown connection';
            states[Connection.ETHERNET] = 'Ethernet connection';
            states[Connection.WIFI] = 'WiFi connection';
            states[Connection.CELL_2G] = 'Cell 2G connection';
            states[Connection.CELL_3G] = 'Cell 3G connection';
            states[Connection.CELL_4G] = 'Cell 4G connection';
            states[Connection.NONE] = 'No network connection';

            $('#connType').html('Connection Type: ' + states[networkState]);
            //alert('Connection type: ' + states[networkState]);
        }
    </script>

</body>
</html>